(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{55:function(e,t,n){},56:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n(0),c=n.n(r),o=n(22),s=n.n(o),i=(n(55),n(56),n(7)),l=n(9),u=n(85),j=n(87),b=n(6),O=n(19),h=c.a.createContext(),p=function(e){return function(t){var n=Object(r.useContext)(h),c=n.user,o=(n.updateUser,n.login),s=n.logout,i=Object(b.a)(Object(b.a)({},c),{},{login:o,logout:s});return Object(a.jsx)(e,Object(b.a)({user:i},t))}},d=p((function(e){var t=e.user,n=e.children,a=Object(O.a)(e,["user","children"]);return t.authState?c.a.Children.map(n,(function(e){return c.a.cloneElement(e,Object(b.a)({},a))})):null})),x=p((function(e){var t=e.user,n=e.children,a=Object(O.a)(e,["user","children"]);return t.authState?null:c.a.Children.map(n,(function(e){return c.a.cloneElement(e,Object(b.a)({},a))}))})),m=function(e){return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)(u.a,{collapseOnSelect:!0,expand:"md",bg:"dark",variant:"dark",children:[Object(a.jsx)(l.b,{to:"/",className:"navbar-brand",children:"Vision web test"}),Object(a.jsx)(u.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),Object(a.jsx)(u.a.Collapse,{children:Object(a.jsxs)(j.a,{className:"mr-auto",children:[Object(a.jsxs)(x,{children:[Object(a.jsx)(l.c,{exact:!0,to:"/signup",activeClassName:"active",className:"nav-link",children:"Sign Up"}),Object(a.jsx)(l.c,{exact:!0,to:"/login",activeClassName:"active",className:"nav-link",children:"Login"})]}),Object(a.jsxs)(d,{children:[Object(a.jsx)(l.c,{exact:!0,to:"/",activeClassName:"active",className:"nav-link",children:"Home"}),Object(a.jsx)(l.c,{exact:!0,to:"/logout",activeClassName:"active",className:"nav-link",children:"Logout"})]})]})})]})})},f=n(11),g=n(83),v=n(18),S=n.n(v),k=p((function(e){var t=e.user,n=Object(r.useState)(),c=Object(f.a)(n,2),o=c[0],s=c[1];return Object(r.useEffect)((function(){S.a.get("http://erp.apptrix.ru/api/clients/".concat(t.client_id,"/")).then((function(e){if(200===e.status){var t=e.data;s(t)}console.log("response",e)})).catch((function(e){return console.log("error",e)}))}),[]),Object(a.jsxs)(g.a,{className:"my-2",children:[Object(a.jsx)("h2",{children:"Home page"}),Object(a.jsx)("p",{children:!!o&&JSON.stringify(o)})]})})),y=n(16),C=n.n(y),N=n(21),w=n(86),_=n(84),L=p((function(e){var t=e.user,n=Object(r.useState)(null),c=Object(f.a)(n,2),o=c[0],s=c[1],u=Object(r.useState)(null),j=Object(f.a)(u,2),b=j[0],O=j[1],h=function(){var e=Object(N.a)(C.a.mark((function e(){var n,a,r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={username:o,password:b},e.next=3,S.a.post("http://erp.apptrix.ru/api/clients/token/",n);case 3:200===(a=e.sent).status&&(r=a.data,t.login(r.client_id,r.access,r.refresh));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return t.authState?Object(a.jsx)(i.a,{to:{pathname:"/"}}):Object(a.jsxs)(g.a,{className:"col-md-6 mx-auto my-2",children:[Object(a.jsx)("h2",{children:"Please login:"}),Object(a.jsxs)(w.a,{children:[Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Email address"}),Object(a.jsx)(w.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){return s(e.target.value)}})]}),Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Password"}),Object(a.jsx)(w.a.Control,{type:"password",placeholder:"Password",onChange:function(e){return O(e.target.value)}})]}),Object(a.jsx)(_.a,{variant:"primary",type:"button",className:"px-5",onClick:h,children:"Login..."}),Object(a.jsx)(l.b,{to:"/signup",className:"btn btn-info px-5 ml-2",children:"Sign Up if unregistered"})]})]})})),E=function(e){var t=Object(r.useState)(null),n=Object(f.a)(t,2),c=n[0],o=n[1],s=Object(r.useState)(null),i=Object(f.a)(s,2),u=i[0],j=i[1],b=Object(r.useState)(null),O=Object(f.a)(b,2),h=O[0],p=O[1],d=Object(r.useState)(null),x=Object(f.a)(d,2),m=x[0],v=x[1],k=Object(r.useState)(null),y=Object(f.a)(k,2),L=y[0],E=y[1],I=function(){var e=Object(N.a)(C.a.mark((function e(){var t;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={user:{email:c,password:u},invited_by:h,name:m,surname:L,country_key:"RU",phone:"+78003002010"},console.log("signup",t),e.next=4,S.a.post("http://erp.apptrix.ru/api/clients/create/",t);case 4:e.sent;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.jsxs)(g.a,{className:"col-md-6 mx-auto my-2",children:[Object(a.jsx)("h2",{children:"Please sign up:"}),Object(a.jsxs)(w.a,{children:[Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Name"}),Object(a.jsx)(w.a.Control,{type:"text",name:"fname",placeholder:"Name",onChange:function(e){return v(e.target.value)}})]}),Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Surname"}),Object(a.jsx)(w.a.Control,{type:"text",name:"lname",placeholder:"Surname",onChange:function(e){return E(e.target.value)}})]}),Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Invited by "}),Object(a.jsx)(w.a.Control,{type:"text",placeholder:"Invited by",onChange:function(e){return p(e.target.value)}})]}),Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Email address"}),Object(a.jsx)(w.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){return o(e.target.value)}})]}),Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Password"}),Object(a.jsx)(w.a.Control,{type:"password",placeholder:"Password",onChange:function(e){return j(e.target.value)}})]}),Object(a.jsx)(_.a,{variant:"primary",type:"button",className:"px-5",onClick:I,children:"Sign Up..."}),Object(a.jsx)(l.b,{to:"/login",className:"btn btn-info px-5 ml-2",children:"Login if registered"})]})]})},I=p((function(e){var t=e.user;return Object(r.useEffect)((function(){t.logout()}),[]),t.authState?null:Object(a.jsx)(i.a,{push:!0,to:{pathname:"/login"}})})),G=p((function(e){var t=e.user,n=e.component,r=Object(O.a)(e,["user","component"]);return t.authState?Object(a.jsx)(i.b,Object(b.a)(Object(b.a)({},r),{},{component:n})):Object(a.jsx)(i.b,Object(b.a)(Object(b.a)({},r),{},{render:function(e){var t=e.location;return Object(a.jsx)(i.a,{to:{pathname:"/login",state:{from:t}}})}}))})),J=p((function(e){var t=e.user,n=e.component,r=Object(O.a)(e,["user","component"]);return t.authState?Object(a.jsx)(i.b,Object(b.a)(Object(b.a)({},r),{},{render:function(e){var t=e.location;return Object(a.jsx)(i.a,{to:{pathname:"/",state:{from:t}}})}})):Object(a.jsx)(i.b,Object(b.a)(Object(b.a)({},r),{},{component:n}))})),P="auth",R=function(e){var t=e.children,n=Object(r.useState)((function(){return function(){var e=JSON.parse(localStorage.getItem(P));return e&&e.token?{authState:!!e.token,client_id:e.client_id,token:e.token,refresh_token:e.refresh_token}:{authState:!1}}()})),c=Object(f.a)(n,2),o=c[0],s=c[1],i=Object(r.useCallback)((function(e,t,n){var a={authState:!!t,client_id:e,token:t,refresh_token:n};localStorage.setItem(P,JSON.stringify({client_id:e,token:t,refresh_token:n})),s(a)}),[]),l=Object(r.useCallback)((function(){localStorage.removeItem(P),s({authState:!1})}),[]);return Object(a.jsx)(h.Provider,{value:{user:o,updateUser:function(e){return s(e)},login:i,logout:l},children:t})};var U=function(){return Object(a.jsxs)(R,{children:[Object(a.jsx)(m,{}),Object(a.jsxs)(i.d,{children:[Object(a.jsx)(J,{path:"/login",component:L}),Object(a.jsx)(J,{path:"/signup",component:E}),Object(a.jsx)(G,{path:"/logout",component:I}),Object(a.jsx)(G,{path:"/",component:k})]})]})},B=n(47),q=n(48),A=n(49),T="auth",H=function(){function e(){Object(q.a)(this,e),this.storageName=T}return Object(A.a)(e,[{key:"onRequest",value:function(e){var t=F();return t&&t.token?(console.log("Axios_onRequest middleware with Bearer Token"),Object(b.a)(Object(b.a)({},e),{},{headers:Object(b.a)(Object(b.a)({},e.headers),{},{Authorization:"Bearer ".concat(t.token)})})):(console.log("Axios_onRequest middleware NO Bearer Token"),e)}},{key:"onResponseError",value:function(e){if(401===e.response.status)return z().then((function(e){V(e),console.log("Refresh token success")})).catch((function(e){throw D(),console.log("Refresh login error: ",e),e}));throw e}}]),e}(),z=function(){var e=Object(N.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){return JSON.parse(localStorage.getItem(T))},V=function(e){localStorage.setItem(T,JSON.stringify(e))},D=function(){localStorage.removeItem(T)};new B.a(S.a).register([new H]);var K=Object(a.jsx)(l.a,{children:Object(a.jsx)(U,{})});s.a.render(K,document.getElementById("root"))}},[[81,1,2]]]);
//# sourceMappingURL=main.055a9c6d.chunk.js.map