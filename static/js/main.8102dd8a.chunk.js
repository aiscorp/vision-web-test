(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{55:function(e,t,n){},56:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n(0),r=n.n(c),o=n(22),s=n.n(o),i=(n(55),n(56),n(7)),l=n(9),u=n(85),j=n(87),b=n(6),h=n(19),O=r.a.createContext(),p=function(e){return function(t){var n=Object(c.useContext)(O),r=n.user,o=(n.updateUser,n.login),s=n.logout,i=Object(b.a)(Object(b.a)({},r),{},{login:o,logout:s});return Object(a.jsx)(e,Object(b.a)({user:i},t))}},d=p((function(e){var t=e.user,n=e.children,a=Object(h.a)(e,["user","children"]);return t.authState?r.a.Children.map(n,(function(e){return r.a.cloneElement(e,Object(b.a)({},a))})):null})),x=p((function(e){var t=e.user,n=e.children,a=Object(h.a)(e,["user","children"]);return t.authState?null:r.a.Children.map(n,(function(e){return r.a.cloneElement(e,Object(b.a)({},a))}))})),m=function(e){return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)(u.a,{collapseOnSelect:!0,expand:"md",bg:"dark",variant:"dark",children:[Object(a.jsx)(l.b,{to:"/",className:"navbar-brand",children:"Vision web test"}),Object(a.jsx)(u.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),Object(a.jsx)(u.a.Collapse,{children:Object(a.jsxs)(j.a,{className:"mr-auto",children:[Object(a.jsxs)(x,{children:[Object(a.jsx)(l.c,{exact:!0,to:"/signup",activeClassName:"active",className:"nav-link",children:"Sign Up"}),Object(a.jsx)(l.c,{exact:!0,to:"/login",activeClassName:"active",className:"nav-link",children:"Login"})]}),Object(a.jsxs)(d,{children:[Object(a.jsx)(l.c,{exact:!0,to:"/",activeClassName:"active",className:"nav-link",children:"Home"}),Object(a.jsx)(l.c,{exact:!0,to:"/logout",activeClassName:"active",className:"nav-link",children:"Logout"})]})]})})]})})},f=n(11),g=n(83),v=n(15),k=n.n(v),S=p((function(e){var t=e.user,n=Object(c.useState)(),r=Object(f.a)(n,2),o=r[0],s=r[1];return Object(c.useEffect)((function(){k.a.get("http://erp.apptrix.ru/api/clients/".concat(t.client_id,"/")).then((function(e){if(200===e.status){var t=e.data;s(t)}console.log("response",e)})).catch((function(e){return console.log("error",e)}))}),[]),Object(a.jsxs)(g.a,{className:"my-2",children:[Object(a.jsx)("h2",{children:"Home page"}),!!o&&y(o)]})})),y=function(e){return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("img",{src:e.avatar,style:{height:"128px"},alt:"avatar"}),Object(a.jsx)("h3",{children:"Hello ".concat(e.name," ").concat(e.surname,"!")}),Object(a.jsx)("p",{children:"Hear is information stored in your account:"}),Object(a.jsx)("p",{children:"Name: ".concat(e.name)}),Object(a.jsx)("p",{children:"Surname: ".concat(e.surname)}),Object(a.jsx)("p",{children:"Email: ".concat(e.email)}),Object(a.jsx)("p",{children:"Phone: ".concat(e.phone)}),Object(a.jsx)("p",{children:"Client ID: ".concat(e.client_id)}),Object(a.jsx)("p",{children:"Invited by: ".concat(e.invited_by.name," ").concat(e.invited_by.surname)})]})},C=n(17),N=n.n(C),w=n(21),_=n(86),E=n(84),I=p((function(e){var t=e.user,n=Object(c.useState)(null),r=Object(f.a)(n,2),o=r[0],s=r[1],u=Object(c.useState)(null),j=Object(f.a)(u,2),b=j[0],h=j[1],O=function(){var e=Object(w.a)(N.a.mark((function e(){var n,a,c;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={username:o,password:b},e.next=3,k.a.post("http://erp.apptrix.ru/api/clients/token/",n);case 3:200===(a=e.sent).status&&(c=a.data,t.login(c.client_id,c.access,c.refresh));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return t.authState?Object(a.jsx)(i.a,{to:{pathname:"/"}}):Object(a.jsxs)(g.a,{className:"col-md-6 mx-auto my-2",children:[Object(a.jsx)("h2",{children:"Please login:"}),Object(a.jsxs)(_.a,{children:[Object(a.jsxs)(_.a.Group,{children:[Object(a.jsx)(_.a.Label,{children:"Email address"}),Object(a.jsx)(_.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){return s(e.target.value)}})]}),Object(a.jsxs)(_.a.Group,{children:[Object(a.jsx)(_.a.Label,{children:"Password"}),Object(a.jsx)(_.a.Control,{type:"password",placeholder:"Password",onChange:function(e){return h(e.target.value)}})]}),Object(a.jsx)(E.a,{variant:"primary",type:"button",className:"px-5",onClick:O,children:"Login..."}),Object(a.jsx)(l.b,{to:"/signup",className:"btn btn-info px-5 ml-2",children:"Sign Up if unregistered"})]})]})})),L=function(e){var t=Object(c.useState)(null),n=Object(f.a)(t,2),r=n[0],o=n[1],s=Object(c.useState)(null),i=Object(f.a)(s,2),u=i[0],j=i[1],b=Object(c.useState)(null),h=Object(f.a)(b,2),O=h[0],p=h[1],d=Object(c.useState)(null),x=Object(f.a)(d,2),m=x[0],v=x[1],S=Object(c.useState)(null),y=Object(f.a)(S,2),C=y[0],I=y[1],L=function(){var e=Object(w.a)(N.a.mark((function e(){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={user:{email:r,password:u},invited_by:O,name:m,surname:C,country_key:"RU",phone:"+78003002010"},console.log("signup",t),e.next=4,k.a.post("http://erp.apptrix.ru/api/clients/create/",t);case 4:e.sent;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.jsxs)(g.a,{className:"col-md-6 mx-auto my-2",children:[Object(a.jsx)("h2",{children:"Please sign up:"}),Object(a.jsxs)(_.a,{children:[Object(a.jsxs)(_.a.Group,{children:[Object(a.jsx)(_.a.Label,{children:"Name"}),Object(a.jsx)(_.a.Control,{type:"text",name:"fname",placeholder:"Name",onChange:function(e){return v(e.target.value)}})]}),Object(a.jsxs)(_.a.Group,{children:[Object(a.jsx)(_.a.Label,{children:"Surname"}),Object(a.jsx)(_.a.Control,{type:"text",name:"lname",placeholder:"Surname",onChange:function(e){return I(e.target.value)}})]}),Object(a.jsxs)(_.a.Group,{children:[Object(a.jsx)(_.a.Label,{children:"Invited by "}),Object(a.jsx)(_.a.Control,{type:"text",placeholder:"Invited by",onChange:function(e){return p(e.target.value)}})]}),Object(a.jsxs)(_.a.Group,{children:[Object(a.jsx)(_.a.Label,{children:"Email address"}),Object(a.jsx)(_.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){return o(e.target.value)}})]}),Object(a.jsxs)(_.a.Group,{children:[Object(a.jsx)(_.a.Label,{children:"Password"}),Object(a.jsx)(_.a.Control,{type:"password",placeholder:"Password",onChange:function(e){return j(e.target.value)}})]}),Object(a.jsx)(E.a,{variant:"primary",type:"button",className:"px-5",onClick:L,children:"Sign Up..."}),Object(a.jsx)(l.b,{to:"/login",className:"btn btn-info px-5 ml-2",children:"Login if registered"})]})]})},P=p((function(e){var t=e.user;return Object(c.useEffect)((function(){t.logout()}),[]),t.authState?null:Object(a.jsx)(i.a,{push:!0,to:{pathname:"/login"}})})),G=p((function(e){var t=e.user,n=e.component,c=Object(h.a)(e,["user","component"]);return t.authState?Object(a.jsx)(i.b,Object(b.a)(Object(b.a)({},c),{},{component:n})):Object(a.jsx)(i.b,Object(b.a)(Object(b.a)({},c),{},{render:function(e){var t=e.location;return Object(a.jsx)(i.a,{to:{pathname:"/login",state:{from:t}}})}}))})),R=p((function(e){var t=e.user,n=e.component,c=Object(h.a)(e,["user","component"]);return t.authState?Object(a.jsx)(i.b,Object(b.a)(Object(b.a)({},c),{},{render:function(e){var t=e.location;return Object(a.jsx)(i.a,{to:{pathname:"/",state:{from:t}}})}})):Object(a.jsx)(i.b,Object(b.a)(Object(b.a)({},c),{},{component:n}))})),J="auth",U=function(e){var t=e.children,n=Object(c.useState)((function(){return function(){var e=JSON.parse(localStorage.getItem(J));return e&&e.token?{authState:!!e.token,client_id:e.client_id,token:e.token,refresh_token:e.refresh_token}:{authState:!1}}()})),r=Object(f.a)(n,2),o=r[0],s=r[1],i=Object(c.useCallback)((function(e,t,n){var a={authState:!!t,client_id:e,token:t,refresh_token:n};localStorage.setItem(J,JSON.stringify({client_id:e,token:t,refresh_token:n})),s(a)}),[]),l=Object(c.useCallback)((function(){localStorage.removeItem(J),s({authState:!1})}),[]);return Object(a.jsx)(O.Provider,{value:{user:o,updateUser:function(e){return s(e)},login:i,logout:l},children:t})};var A=function(){return Object(a.jsxs)(U,{children:[Object(a.jsx)(m,{}),Object(a.jsxs)(i.d,{children:[Object(a.jsx)(R,{path:"/login",component:I}),Object(a.jsx)(R,{path:"/signup",component:L}),Object(a.jsx)(G,{path:"/logout",component:P}),Object(a.jsx)(G,{path:"/",component:S})]})]})},T=n(47),B=n(48),H=n(49),q="auth",F=function(){function e(){Object(B.a)(this,e),this.storageName=q}return Object(H.a)(e,[{key:"onRequest",value:function(e){var t=D();return t&&t.token?(console.log("Axios_onRequest middleware with Bearer Token"),Object(b.a)(Object(b.a)({},e),{},{headers:Object(b.a)(Object(b.a)({},e.headers),{},{Authorization:"Bearer ".concat(t.token)})})):(console.log("Axios_onRequest middleware NO Bearer Token"),e)}},{key:"onResponseError",value:function(e){if(401===e.response.status)return z().then((function(e){V(e),console.log("Refresh token success")})).catch((function(e){throw K(),console.log("Refresh login error: ",e),e}));throw e}}]),e}(),z=function(){var e=Object(w.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",k.a.get("http://erp.apptrix.ru/api/clients/token/refresh/").then((function(e){if(200===e.status){var t=e.data;return console.log("refreshAccessToken data",t),t}console.log("refreshAccessToken res",e)})).catch((function(e){return console.log("error",e),e})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){return JSON.parse(localStorage.getItem(q))},V=function(e){localStorage.setItem(q,JSON.stringify(e))},K=function(){localStorage.removeItem(q)};new T.a(k.a).register([new F]);var M=Object(a.jsx)(l.a,{children:Object(a.jsx)(A,{})});s.a.render(M,document.getElementById("root"))}},[[81,1,2]]]);
//# sourceMappingURL=main.8102dd8a.chunk.js.map