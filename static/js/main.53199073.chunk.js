(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{55:function(e,t,n){},56:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var a=n(2),c=n(0),r=n.n(c),s=n(22),o=n.n(s),l=(n(55),n(56),n(6)),i=n(9),u=n(85),j=n(87),b=n(8),O=n(21),h=n(10),d="auth",p=function(e){return function(t){var n=Object(c.useState)(null),r=Object(h.a)(n,2),s=r[0],o=r[1],l=Object(c.useState)(null),i=Object(h.a)(l,2),u=i[0],j=i[1],O=Object(c.useState)(null),p=Object(h.a)(O,2),m=p[0],x=p[1],f=Object(c.useState)(!1),g=Object(h.a)(f,2),v=g[0],k=g[1],S=Object(c.useCallback)((function(e,t,n){o(e),j(t),x(n),console.log("withAuth login",e),localStorage.setItem(d,JSON.stringify({client_id:e,token:t,refresh_token:n}))}),[]),y=Object(c.useCallback)((function(){o(null),j(null),x(null),localStorage.removeItem(d)}),[]);Object(c.useEffect)((function(){var e=JSON.parse(localStorage.getItem(d));e&&e.token&&S(e.client_id,e.token,e.refresh_token),k(!0)}),[S]);var w={authState:!!u,client_id:s,token:u,refresh_token:m,ready:v,login:S,logout:y};return Object(a.jsx)(e,Object(b.a)({user:w},t))}},m=p((function(e){var t=e.user,n=e.children,a=Object(O.a)(e,["user","children"]);return t.authState?r.a.Children.map(n,(function(e){return r.a.cloneElement(e,Object(b.a)({},a))})):null})),x=p((function(e){var t=e.user,n=e.children,a=Object(O.a)(e,["user","children"]);return t.authState?null:r.a.Children.map(n,(function(e){return r.a.cloneElement(e,Object(b.a)({},a))}))})),f=function(e){return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)(u.a,{collapseOnSelect:!0,expand:"md",bg:"dark",variant:"dark",children:[Object(a.jsx)(i.b,{to:"/",className:"navbar-brand",children:"Vision web test"}),Object(a.jsx)(u.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),Object(a.jsx)(u.a.Collapse,{children:Object(a.jsxs)(j.a,{className:"mr-auto",children:[Object(a.jsxs)(x,{children:[Object(a.jsx)(i.c,{exact:!0,to:"/",activeClassName:"active",className:"nav-link",children:"Home"}),Object(a.jsx)(i.c,{exact:!0,to:"/signup",activeClassName:"active",className:"nav-link",children:"Sign Up"}),Object(a.jsx)(i.c,{exact:!0,to:"/login",activeClassName:"active",className:"nav-link",children:"Login"})]}),Object(a.jsx)(m,{children:Object(a.jsx)(i.c,{exact:!0,to:"/logout",activeClassName:"active",className:"nav-link",children:"Logout"})})]})})]})})},g=n(83),v=function(e){return Object(a.jsx)(g.a,{className:"my-2",children:Object(a.jsx)("h2",{children:"Home page"})})},k=n(16),S=n.n(k),y=n(19),w=n(86),C=n(84),N=n(20),L=n.n(N),_=p((function(e){var t=e.user,n=Object(c.useState)(null),r=Object(h.a)(n,2),s=r[0],o=r[1],l=Object(c.useState)(null),u=Object(h.a)(l,2),j=u[0],b=u[1],O=function(){var e=Object(y.a)(S.a.mark((function e(){var n,a,c;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={username:s,password:j},console.log("login request",n),e.next=4,L.a.post("https://erp.apptrix.ru/api/clients/token/",n);case 4:200===(a=e.sent).status&&(c=a.data,t.login(c.client_id,c.access,c.refresh)),console.log("login response",a);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.jsxs)(g.a,{className:"col-md-6 mx-auto my-2",children:[Object(a.jsx)("h2",{children:"Please login:"}),Object(a.jsxs)(w.a,{children:[Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Email address"}),Object(a.jsx)(w.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){return o(e.target.value)}})]}),Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Password"}),Object(a.jsx)(w.a.Control,{type:"password",placeholder:"Password",onChange:function(e){return b(e.target.value)}})]}),Object(a.jsx)(C.a,{variant:"primary",type:"button",className:"px-5",onClick:O,children:"Login..."}),Object(a.jsx)(i.b,{to:"/signup",className:"btn btn-info px-5 ml-2",children:"Sign Up if unregistered"})]})]})})),E=function(e){var t=Object(c.useState)(null),n=Object(h.a)(t,2),r=n[0],s=n[1],o=Object(c.useState)(null),l=Object(h.a)(o,2),u=l[0],j=l[1],b=Object(c.useState)(null),O=Object(h.a)(b,2),d=O[0],p=O[1],m=Object(c.useState)(null),x=Object(h.a)(m,2),f=x[0],v=x[1],k=Object(c.useState)(null),N=Object(h.a)(k,2),_=N[0],E=N[1],I=function(){var e=Object(y.a)(S.a.mark((function e(){var t;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={user:{email:r,password:u},invited_by:d,name:f,surname:_,country_key:"RU",phone:"+78003002010"},console.log("signup",t),e.next=4,L.a.post("http://erp.apptrix.ru/api/clients/create/",t);case 4:e.sent;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.jsxs)(g.a,{className:"col-md-6 mx-auto my-2",children:[Object(a.jsx)("h2",{children:"Please sign up:"}),Object(a.jsxs)(w.a,{children:[Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Name"}),Object(a.jsx)(w.a.Control,{type:"text",name:"fname",placeholder:"Name",onChange:function(e){return v(e.target.value)}})]}),Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Surname"}),Object(a.jsx)(w.a.Control,{type:"text",name:"lname",placeholder:"Surname",onChange:function(e){return E(e.target.value)}})]}),Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Invited by "}),Object(a.jsx)(w.a.Control,{type:"text",placeholder:"Invited by",onChange:function(e){return p(e.target.value)}})]}),Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Email address"}),Object(a.jsx)(w.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){return s(e.target.value)}})]}),Object(a.jsxs)(w.a.Group,{children:[Object(a.jsx)(w.a.Label,{children:"Password"}),Object(a.jsx)(w.a.Control,{type:"password",placeholder:"Password",onChange:function(e){return j(e.target.value)}})]}),Object(a.jsx)(C.a,{variant:"primary",type:"button",className:"px-5",onClick:I,children:"Sign Up..."}),Object(a.jsx)(i.b,{to:"/login",className:"btn btn-info px-5 ml-2",children:"Login if registered"})]})]})},I=function(e){return Object(c.useEffect)((function(){}),[]),Object(a.jsx)(a.Fragment,{children:"logout"})},G=p((function(e){var t=e.user,n=e.component,c=Object(O.a)(e,["user","component"]);return t.authState?Object(a.jsx)(l.b,Object(b.a)(Object(b.a)({},c),{},{component:n})):Object(a.jsx)(l.b,Object(b.a)(Object(b.a)({},c),{},{render:function(e){var t=e.location;return Object(a.jsx)(l.a,{to:{pathname:"/login",state:{from:t}}})}}))}));var R=function(){return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(f,{}),Object(a.jsxs)(l.d,{children:[Object(a.jsx)(l.b,{path:"/login",component:_}),Object(a.jsx)(l.b,{path:"/signup",component:E}),Object(a.jsx)(G,{path:"/",component:v}),Object(a.jsx)(G,{path:"/logout",component:I})]})]})},J=n(47),P=n(48),q=n(49),A="auth",B=function(){function e(){Object(P.a)(this,e),this.storageName=A}return Object(q.a)(e,[{key:"onRequest",value:function(e){var t=F();return t&&t.token?(console.log("Axios_onRequest middleware with Bearer Token"),Object(b.a)(Object(b.a)({},e),{},{headers:Object(b.a)(Object(b.a)({},e.headers),{},{Authorization:"Bearer ".concat(t.token)})})):(console.log("Axios_onRequest middleware NO Bearer Token"),e)}},{key:"onResponseError",value:function(e){if(401===e.response.status)return U().then((function(e){T(e),console.log("Refresh token success")})).catch((function(e){throw H(),console.log("Refresh login error: ",e),e}));throw e}}]),e}(),U=function(){var e=Object(y.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){return JSON.parse(localStorage.getItem(A))},T=function(e){localStorage.setItem(A,JSON.stringify(e))},H=function(){localStorage.removeItem(A)};new J.a(L.a).register([new B]);var z=Object(a.jsx)(i.a,{children:Object(a.jsx)(R,{})});o.a.render(z,document.getElementById("root"))}},[[81,1,2]]]);
//# sourceMappingURL=main.53199073.chunk.js.map